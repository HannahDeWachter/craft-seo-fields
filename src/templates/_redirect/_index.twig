{# @var craft \craft\web\twig\variables\CraftVariable #}
{% extends "_layouts/cp" %}

{% import "_includes/forms" as forms %}

{% set selectedSubnavItem = 'redirects' %}
{% set title = "Redirects" %}

{% block header %}
    {{ block('pageTitle') }}
    {{ block('contextMenu') }}
    <div class="flex-grow"></div>
    <a href="{{ cpUrl('seo-fields/redirects/add') }}" class="btn submit"><span data-icon="plus"></span> {{ 'New redirect'|t('seo-fields') }}</a>
{% endblock %}

{% block content %}
    <table class="data fullwidth collapsible">
        <thead>
        <tr>
            <th>{{ "Pattern / URL"|t('seo-fields') }}</th>
            <th>{{ "Redirect to"|t('seo-fields') }}</th>
            {% if craft.app.getIsMultiSite() %}
                <th>{{ "Site"|t('seo-fields') }}</th>
            {% endif %}
            <th>{{ "Hits"|t('seo-fields') }}</th>
            <th>{{ "Matched by"|t('seo-fields') }}</th>
            <th>{{ "Last hit at"|t('seo-fields') }}</th>
            <th>{{ "Method"|t('seo-fields') }}</th>
            <th>{{ "Remove"|t('seo-fields') }}</th>
        </tr>
        </thead>
        <tbody>
        {% for row in redirects %}
        <tr>
            <td><a href="{{ cpUrl('seo-fields/redirects/edit/' ~ row.id) }}">{{ row.pattern }}</a></td>
            <td>{{ row.redirect }}</td>
            {% if craft.app.getIsMultiSite() %}
                {% if row.siteId %}
                    {% set site = craft.app.sites.getSiteById(row.siteId) %}
                    {% set site = site.name %}
                {% else %}
                    {% set site = 'All sites'|t('seo-fields') %}
                {% endif %}
                <td>{{ site  }}</td>
            {% endif %}
            <td class="light">{{ row.counter ?? 0 }}</td>
            <td class="light">{{ row.sourceMatch == "url" ? 'Full url' : 'Path only' }}</td>
            <td class="light">{{ row.dateLastHit|length ? row.dateLastHit|date('d/m/Y H:i') : '-' }}</td>
            <td class="light">{{ row.method }}</td>
            <td><a href="{{ cpUrl('seo-fields/redirects/delete/' ~ row.id) }}" class="delete icon" title="Delete"></a></td>
        </tr>
        </tbody>
        {% endfor %}
    </table>
{% endblock %}